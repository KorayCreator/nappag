<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>/anon/ - Nappag Fikir Paylaşımı</title>
    <style>
        :root { 
            --board-bg: #F5F1E6; 
            --nappag-yellow: #FFDB5E; 
            --maroon: #800000;
            --border-color: #D9BF55;
            --post-bg: #F0E0D6;
            --name-green: #117743;
            --quote-green: #789922;
        }
        
        body { 
            background-color: var(--board-bg); 
            font-family: "Times New Roman", Times, serif; 
            margin: 0; 
            color: #1a1a1a; 
            text-align: center;
        }

        header { 
            background-color: var(--nappag-yellow); 
            border-bottom: 2px solid var(--border-color); 
            padding: 10px; 
            font-weight: bold;
            font-size: 14px;
        }
        header a { color: #34345C; text-decoration: none; margin: 0 12px; }

        .banner { padding: 30px 0; border-bottom: 1px dotted #aaa; }
        
        /* Simetrik ve Kare Logo Alanı */
        .logo-box { 
            display: inline-block; 
            border: 3px solid #000; 
            padding: 15px 30px; 
            background: #fff;
            box-shadow: 4px 4px 0px #000;
            margin-bottom: 10px;
        }
        .logo-text { 
            font-size: 36px; 
            font-weight: bold; 
            color: var(--maroon); 
            vertical-align: middle;
            letter-spacing: 1px;
        }
        .robot-head {
            display: inline-block;
            width: 38px;
            height: 38px;
            background: var(--nappag-yellow);
            border: 2px solid #000;
            vertical-align: middle;
            margin-left: 15px;
            position: relative;
        }
        .robot-head::before { content: '..'; position: absolute; top: -2px; left: 6px; font-size: 24px; font-weight: bold; }
        .robot-head::after { content: ''; position: absolute; bottom: 8px; left: 10px; width: 16px; height: 2px; background: #000; }

        .banner h2 { color: var(--maroon); font-size: 22px; margin-top: 15px; }
        .banner p { color: var(--maroon); font-size: 14px; font-weight: bold; max-width: 600px; margin: 10px auto; }

        /* Gelişmiş Form */
        .post-form-wrap { display: flex; justify-content: center; margin: 25px 0; }
        .post-form { 
            background-color: var(--nappag-yellow); 
            border: 2px solid var(--border-color); 
            padding: 20px; 
            width: 600px; 
            text-align: left;
            box-shadow: 3px 3px 0px rgba(0,0,0,0.1);
        }
        .post-form input, .post-form textarea, .post-form select { 
            width: 100%; 
            border: 1px solid var(--border-color); 
            padding: 10px; 
            margin-bottom: 10px; 
            box-sizing: border-box; 
            font-family: inherit;
            font-size: 15px;
        }
        
        .form-footer { display: flex; gap: 10px; align-items: center; }
        .file-label { background: #eee; border: 1px solid #999; padding: 8px; flex: 1; font-size: 12px; cursor: pointer; }
        .btn-submit { 
            background-color: #eee; 
            border: 1px solid #999; 
            padding: 10px 40px; 
            font-weight: bold; 
            cursor: pointer; 
            font-size: 16px;
        }
        .btn-submit:hover { background: #fff; border-color: var(--maroon); }

        /* Mesaj Akışı ve Özellikler */
        #board-main { max-width: 950px; margin: 0 auto; text-align: left; padding: 20px; }
        .thread { border-top: 1px solid var(--border-color); padding: 25px 0; }
        .post { background-color: var(--post-bg); border: 1px solid var(--border-color); padding: 15px; display: inline-block; min-width: 450px; max-width: 98%; box-shadow: 1px 1px 2px rgba(0,0,0,0.05); }
        .post-header { font-size: 13px; margin-bottom: 10px; color: #555; border-bottom: 1px solid rgba(0,0,0,0.05); padding-bottom: 5px; }
        .post-name { color: var(--name-green); font-weight: bold; }
        .post-id { color: var(--maroon); cursor: pointer; text-decoration: underline; }
        
        .post-img { float: left; margin: 0 20px 10px 0; max-width: 250px; border: 1px solid var(--border-color); cursor: zoom-in; transition: transform 0.2s; }
        .post-img:active { transform: scale(1.5); position: relative; z-index: 100; }
        
        .post-body { font-size: 16px; line-height: 1.5; }
        .quote { color: var(--quote-green); }
        .spoiler { background: #000; color: #000; padding: 0 2px; cursor: pointer; }
        .spoiler:hover { color: #fff; }
        .clear { clear: both; }

        .tag { background: var(--maroon); color: #fff; padding: 2px 6px; font-size: 11px; border-radius: 3px; margin-right: 5px; vertical-align: middle; }
    </style>
</head>
<body>

<header>
    [ <a href="#">Fikirler</a> ][ <a href="#">Popüler</a> ][ <a href="#">Katalog</a> ][ <a href="#">Kurallar</a> ]
</header>

<div class="banner">
    <div class="logo-box">
        <span class="logo-text">NAPPAG</span>
        <div class="robot-head"></div>
    </div>
    <h2>Anonim Fikir Paylaşma Platformu</h2>
    <p>Fikirlerinizi özgürce ama saygı çerçevesinde paylaşın. <br> Siyaset ve hakaret yasaktır. Burası robotların değil, özgür düşüncenin evi.</p>
</div>

<div class="post-form-wrap">
    <div class="post-form">
        <div style="display: flex; gap: 10px;">
            <input type="text" id="name" placeholder="Rumuz (Opsiyonel)" style="flex: 1;">
            <select id="tag" style="flex: 0.5;">
                <option value="GENEL">Genel</option>
                <option value="FİKİR">Fikir</option>
                <option value="SORU">Soru</option>
                <option value="TARTIŞMA">Tartışma</option>
                <option value="İTİRAF">İtiraf</option>
            </select>
        </div>
        <input type="text" id="subject" placeholder="Konu Başlığı / Özet">
        <textarea id="message" rows="6" placeholder="Bir fikrin mi var anonim? Spoiler için [s]metin[/s] kullan, alıntı için > kullan."></textarea>
        <div class="form-footer">
            <input type="file" id="file" class="file-label" accept="image/*" onchange="handleImg()">
            <button class="btn-submit" onclick="submitPost()">FİKRİ PAYLAŞ</button>
        </div>
    </div>
</div>

<div id="board-main">
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    const cfg = { 
        apiKey: "AIzaSyBc1oohhXQFNr5QsoPG1VBc5lTMGaMoyos", 
        authDomain: "nappag-8c527.firebaseapp.com", 
        projectId: "nappag-8c527", 
        storageBucket: "nappag-8c527.firebasestorage.app", 
        messagingSenderId: "370496474734", 
        appId: "1:370496474734:web:172774434cb14af279207f" 
    };
    const app = initializeApp(cfg);
    const db = getFirestore(app);

    let imgData = "";
    window.handleImg = () => {
        const file = document.getElementById('file').files[0];
        const reader = new FileReader();
        reader.onloadend = () => { imgData = reader.result; }
        if (file) reader.readAsDataURL(file);
    };

    window.submitPost = async () => {
        const msg = document.getElementById('message').value;
        if(!msg && !imgData) return;
        
        await addDoc(collection(db, "anon_posts"), {
            name: document.getElementById('name').value || "Anonim",
            tag: document.getElementById('tag').value,
            sub: document.getElementById('subject').value || "Başlıksız",
            msg: msg,
            img: imgData,
            ts: serverTimestamp()
        });

        document.getElementById('message').value = "";
        document.getElementById('subject').value = "";
        document.getElementById('file').value = "";
        imgData = "";
    };

    // Mesaj İşleme Fonksiyonu (Spoiler ve Quote)
    function parseMessage(text) {
        return text
            .replace(/^>(.*)/gm, '<span class="quote">>$1</span>')
            .replace(/\[s\](.*?)\[\/s\]/g, '<span class="spoiler">$1</span>');
    }

    onSnapshot(query(collection(db, "anon_posts"), orderBy("ts", "desc")), (sn) => {
        document.getElementById('board-main').innerHTML = sn.docs.map(doc => {
            const p = doc.data();
            const time = p.ts ? new Date(p.ts.seconds*1000).toLocaleString('tr-TR') : 'Az önce';
            return `
                <div class="thread">
                    <div class="post">
                        <div class="post-header">
                            <span class="tag">${p.tag}</span>
                            <span class="post-name">${p.name}</span> 
                            ${time} <span class="post-id" onclick="document.getElementById('message').value += '>>${doc.id.substring(0,6)}\\n'">No.${doc.id.substring(0,8)}</span>
                        </div>
                        ${p.img ? `<img src="${p.img}" class="post-img" title="Büyütmek için basılı tutun">` : ''}
                        <div class="post-body">
                            <b style="color:var(--maroon)">${p.sub}</b><br>
                            ${parseMessage(p.msg)}
                        </div>
                        <div class="clear"></div>
                    </div>
                </div>`;
        }).join('');
    });
</script>
</body>
</html>
